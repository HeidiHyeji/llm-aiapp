# ✅ 8.2.3 상대적 위치 인코딩 (Relative Positional Encoding)

## 🧠 왜 필요한가?

Transformer는 순서를 인식하지 못함 →
→ 단어가 어떤 **순서에 있는지** 또는 **서로 얼마나 떨어져 있는지**를 알려줘야 함.

---

## ❌ 기존 방식: 절대 위치 인코딩 (Absolute Positional Encoding)

* 사인/코사인 함수로 각 위치에 고정된 값을 부여
* 예: pos=0 → \[sin(0), cos(0)], pos=1 → \[sin(1), cos(1)] …

### 🔻 단점

* **같은 단어라도 위치가 바뀌면 완전히 다른 벡터**
* **의미는 같아도 모델은 다르게 이해**
* 문장이 길어지면 성능 저하

---

## ✅ 개선: 상대적 위치 인코딩 (Relative Positional Encoding)

> 단어 간 **“상대 거리”** 정보를 중심으로 인코딩하여
> 문장의 길이나 구조가 바뀌어도 **일관된 의미 파악** 가능

---

## 🌀 방법 1: RoPE (Rotary Positional Embedding)

| 설명                           |
| ---------------------------- |
| 단어 임베딩 벡터를 **위치마다 조금씩 회전**시킴 |
| → 벡터 간 **회전 차이 = 상대 위치 정보**  |
| → 같은 간격이면 같은 내적 결과를 얻음       |

### 💬 비유
<img width="447" alt="image" src="https://github.com/user-attachments/assets/4c64e3ae-3fac-4a6e-9cd6-6aa1a8d9a630" />

* 단어마다 **화살표 방향**이 다르다!
* 화살표 간 **각도 차이**로 서로 얼마나 떨어졌는지 판단

```
[단어1] → ↗
[단어2] → →
[단어3] → ↘
```

---

## 📏 방법 2: ALiBi (Attention with Linear Biases)

| 설명                                        |
| ----------------------------------------- |
| Query-Key 내적 값에 **거리만큼 벌점(bias)**을 더함 |
| → 가까운 단어는 점수 유지, 멀수록 점수 감소                |
| → softmax 계산 전에 처리하므로 효율적                 |



<img width="370" alt="image" src="https://github.com/user-attachments/assets/772f9ffa-af9c-4ae8-8e04-699ad8821952" />

### 💬 비유

* 가까운 단어는 점수 그대로 ✔️
* 멀리 있는 단어는 점수 깎임 ❌

```
[고양이] ↔︎ [먹었다] → 거리=3 → 점수 -3b
[고양이] ↔︎ [옛날이야기] → 거리=10 → 점수 -10b
```

---

## 📊 RoPE vs ALiBi 비교표

| 항목        | RoPE             | ALiBi                |
| --------- | ---------------- | -------------------- |
| 방식        | 벡터를 회전           | 점수에 거리-based bias 추가 |
| 구조적 의미    | 회전 각도 차이 → 상대 위치 | 거리 차이만 반영            |
| 계산 방식     | 내적 전 회전          | 내적 후 편향 추가           |
| 문장 길이 일반화 | 보통               | 뛰어남                  |
| 구현 복잡도    | 중간               | 간단                   |
| 대표 사용 모델  | GPT-J, GPT-Neo   | GPT-NeoX, LLaMA 등    |

---

## 🔚 요약 한 줄

> 🔹 **RoPE는 벡터를 회전시켜 상대 위치를 표현하고**,
> 🔸 **ALiBi는 거리만큼 점수를 깎아주며 위치를 표현한다.**
